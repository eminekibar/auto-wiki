name: Otomatik Wiki JeneratÃ¶rÃ¼

# 1. TETÄ°KLEYÄ°CÄ°: Ne zaman Ã§alÄ±ÅŸacak?
on:
  pull_request:
    types:
      - closed # PR kapatÄ±ldÄ±ÄŸÄ±nda tetikle

env:
  OLLAMA_MODELS: /home/runner/.ollama/models

# 2. GÃ–REVLER: Neler yapÄ±lacak?
jobs:
  update-changelog:
    # Sadece PR "Merge" edilerek kapatÄ±ldÄ±ysa Ã§alÄ±ÅŸ (Ä°ptal edildiyse Ã§alÄ±ÅŸma)
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest # Robotumuzun Ã§alÄ±ÅŸacaÄŸÄ± sanal makine
    
    # Ä°zinler: Robotun dosyaya yazÄ±p commit atabilmesi iÃ§in yetki veriyoruz
    permissions:
      contents: write

    steps:
      # AdÄ±m A: Projenin kodlarÄ±nÄ± sanal makineye indir
      - name: Kodu Ä°ndir (Checkout)
        uses: actions/checkout@v3
        with:
          ref: ${{ github.base_ref }}

      - name: ğŸ“¦ Yapay Zeka Modelini Ã–nbelleÄŸe Al
        uses: actions/cache@v3
        with:
          # Kaydedilecek klasÃ¶r
          path: /home/runner/.ollama/models
          # Bu isme bakarak rafÄ± bulacak
          key: ollama-llama3.2-1b-${{ runner.os }}

      # AdÄ±m B: Ollama Kur ve Yerel LLM'i Ã‡alÄ±ÅŸtÄ±r
      - name: ğŸ¤– Yerel LLM ile PR Ã–zeti Ã‡Ä±kar
        run: |
          echo "1. Ollama (Yapay Zeka Motoru) Kuruluyor..."
          curl -fsSL https://ollama.com/install.sh | sh
          
          echo "2. Ollama Arka Planda BaÅŸlatÄ±lÄ±yor..."
          ollama serve &
          sleep 5 # Motorun Ä±sÄ±nmasÄ± iÃ§in 5 saniye bekle
          
          echo "3. Llama 3.2 (1B) Modeli Ä°ndiriliyor (Bu yaklaÅŸÄ±k 1-2 dakika sÃ¼rer)..."
          ollama pull llama3.2:1b
          
          echo "4. Yapay Zekaya PR Bilgileri GÃ¶nderiliyor..."
          # Robotumuza komutu veriyoruz
          PROMPT="Sen kÄ±demli bir DevOps mÃ¼hendisisin. LÃ¼tfen ÅŸu Pull Request bilgisini oku ve sadece 1-2 cÃ¼mlelik kÄ±sa, profesyonel bir sÃ¼rÃ¼m notu (release note) Ã¶zeti yaz. BaÅŸlÄ±k: '${{ github.event.pull_request.title }}', AÃ§Ä±klama: '${{ github.event.pull_request.body }}'."
          
          # Ollama'dan cevabÄ± alÄ±p bir deÄŸiÅŸkene kaydediyoruz
          AI_SUMMARY=$(ollama run llama3.2:1b "$PROMPT")
          
          echo "5. LLM Ã–zeti CHANGELOG dosyasÄ±na yazÄ±lÄ±yor..."
          echo "## Yeni PR: ${{ github.event.pull_request.title }}" >> CHANGELOG.md
          echo "**Yapay Zeka Ã–zeti:** $AI_SUMMARY" >> CHANGELOG.md
          echo "**Tarih:** $(date +'%d-%m-%Y')" >> CHANGELOG.md
          echo "---" >> CHANGELOG.md

      # AdÄ±m C: DeÄŸiÅŸen CHANGELOG.md dosyasÄ±nÄ± otomatik olarak Git'e kaydet
      - name: DeÄŸiÅŸiklikleri Git'e Kaydet (Auto-Commit)
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "docs: PR detaylarÄ± CHANGELOG'a otomatik eklendi ğŸ¤–"
          branch: main